<!DOCTYPE html>
<html>
<head>
  <title>FREELY™ Biomimicry Advisory Dashboard</title>
  <style>
    body { font-family: Arial; max-width: 700px; margin: 40px auto; background: #f4f6f8; }
    h1 { text-align: center; }
    .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    label { display: block; margin-top: 10px; }
    input[type=range] { width: 100%; }
    button { margin-top: 20px; padding: 12px; width: 100%; font-size: 16px; background: black; color: white; border: none; border-radius: 6px; cursor: pointer; }
    .slider-container { margin-bottom: 12px; }
    .slider-bar { height: 12px; border-radius: 6px; background: #ddd; position: relative; margin-top: 4px; }
    .slider-fill { height: 100%; border-radius: 6px; width: 50%; }
    #result, #aiResult, #advisory { margin-top: 20px; font-size: 18px; }
    #aiResult { white-space: pre-wrap; text-align: left; }
    .badge { display: inline-block; padding: 3px 8px; border-radius: 5px; margin: 2px; color: white; font-weight: bold; font-size: 14px; }
    .strong { background: green; }
    .moderate { background: orange; }
    .weak { background: red; }
    #advisory { white-space: pre-wrap; }
  </style>
</head>
<body>

<h1>FREELY™ Biomimicry Advisory Dashboard</h1>

<div class="card">
  <label for="decision">Enter your decision:</label>
  <textarea id="decision" rows="3" cols="50" placeholder="Type a decision here"></textarea>

  <div id="sliders"></div>

  <button onclick="calculateScore()">Calculate FREELY Score</button>
  <button onclick="analyzeDecision()">Analyze with FREELY AI</button>

  <div id="result"></div>
  <div id="aiResult"></div>
  <div id="advisory"></div>
</div>

<script>
// FREELY Principles
const principles = [
  "Regeneration",
  "Resilience",
  "Decentralization",
  "Energy Efficiency",
  "Human Flourishing",
  "Long-Term Stability",
  "Biblical Ethics"
];

// Generate sliders
const container = document.getElementById("sliders");
principles.forEach((p,i)=>{
  container.innerHTML += `
    <div class="slider-container">
      <label>${p}: <span id="v${i}">5</span></label>
      <input type="range" min="1" max="10" value="5" id="s${i}" oninput="updateSlider(${i})">
      <div class="slider-bar"><div class="slider-fill" id="fill${i}"></div></div>
    </div>
  `;
});

// Update slider fill, color, and live score
function updateSlider(i){
  const val = Number(document.getElementById("s"+i).value);
  document.getElementById("v"+i).innerText = val;

  const fill = document.getElementById("fill"+i);
  let color = val>=8 ? "green" : val>=5 ? "orange" : "red";
  fill.style.width = (val*10)+"%";
  fill.style.background = color;

  updateLiveScore();
}

// Calculate score and generate badges
function calculateScore(){
  let total=0;
  let principleStatusHTML = "";
  const principleLevels = [];

  principles.forEach((p,i)=>{
    const val = Number(document.getElementById("s"+i).value);
    total += val;
    let level = val>=8 ? "Strong" : val>=5 ? "Moderate" : "Weak";
    principleLevels.push(level);
    principleStatusHTML += `<span class="badge ${level.toLowerCase()}">${p}: ${level}</span> `;
  });

  const score = (total/principles.length).toFixed(2);
  let status="", color="";
  if(score>=8){ status="THRIVE"; color="green"; }
  else if(score>=5){ status="RISK"; color="orange"; }
  else{ status="COLLAPSE"; color="red"; }

  window.currentPrincipleLevels = principleLevels;

  document.getElementById("result").innerHTML =
    `FREELY Score: ${score} <span style="color:${color}; font-weight:bold">${status}</span><br>` +
    principleStatusHTML;
}

// Live score update
function updateLiveScore(){ calculateScore(); }
principles.forEach((_,i)=>updateSlider(i));

// AI Analysis with Advisory
async function analyzeDecision(){
  const decision = document.getElementById("decision").value;
  const scores = principles.map((p,i)=>`${p}: ${document.getElementById("s"+i).value}`);
  const levels = window.currentPrincipleLevels.map((l,i)=>`${principles[i]}: ${l}`);

  const prompt = `
You are FREELY, a biomimicry decision intelligence system.

Decision:
${decision}

Scores:
${scores.join("\n")}

Principle Levels:
${levels.join("\n")}

Explain:
- resilience impact
- biomimicry alignment
- ethical consequences
- long-term survival outlook
- highlight weak principles in red, moderate in orange, strong in green
- provide specific actionable improvements for any principle that is Weak or Moderate
`;

  try{
    const response = await fetch(
      "https://frosty-wave-c4b6.dave-21f.workers.dev",
      { method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({prompt}) }
    );

    const data = await response.json();
    let aiText = data.choices[0]?.message?.content || "No response from AI.";

    // Color-code principle mentions in AI response
    aiText = aiText.replace(/Strong/g,'<span class="badge strong">Strong</span>')
                   .replace(/Moderate/g,'<span class="badge moderate">Moderate</span>')
                   .replace(/Weak/g,'<span class="badge weak">Weak</span>');

    document.getElementById("aiResult").innerHTML = aiText;

    // Extract advisory improvements (optional simple parsing)
    const advisoryLines = aiText.split('\n').filter(line => line.toLowerCase().includes('improve') || line.toLowerCase().includes('urgent'));
    document.getElementById("advisory").innerHTML = advisoryLines.length>0 ? 
      "<b>FREELY Advisory:</b><br>" + advisoryLines.join('<br>') : "";

  }catch(err){
    console.error(err);
    document.getElementById("aiResult").innerText = "Error connecting to AI.";
    document.getElementById("advisory").innerText = "";
  }
}
</script>

</body>
</html>
